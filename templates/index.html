<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jar of hearts ğŸ«™ğŸ’•</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body class="pink-world">

<iframe id="bgMusic1" src="https://www.youtube.com/embed/0zoEjHwOUgo?autoplay=0&loop=1&playlist=0zoEjHwOUgo" style="display:none;" allow="autoplay"></iframe>
<iframe id="bgMusic2" src="https://www.youtube.com/embed/CpbJO2Z6DA4?autoplay=0&loop=1&playlist=CpbJO2Z6DA4" style="display:none;" allow="autoplay"></iframe>
<button class="music-btn" id="musicBtn" onclick="toggleMusic()">ğŸµ</button>
<div class="rain-hearts" id="rainHearts"></div>
<div class="blob blob1"></div>
<div class="blob blob2"></div>
<div class="blob blob3"></div>

<div class="container">
    <div class="hero">
        <div class="jar-bounce">ğŸ«™</div>
        <h1>jar of hearts</h1>
        <p class="subtitle">drop something sweet inside.<br>send it to the one who makes your heart go ğŸ’—</p>
        <div class="hearts-row">ğŸ’— ğŸŒ¸ ğŸ’• âœ¨ ğŸ’— ğŸŒ¸ ğŸ’•</div>
    </div>

    <div class="form-card">
        <div class="card-deco top">ğŸ’— Â· Â· Â· ğŸ’—</div>
        <form action="/create" method="POST" id="mainForm">
            <div class="form-group">
                <label>ğŸŒ¸ your name</label>
                <input type="text" name="sender" id="sender" required placeholder="what do they call you?">
            </div>
            <div class="form-group">
                <label>ğŸ’Œ their name</label>
                <input type="text" name="receiver" id="receiver" required placeholder="who is this jar for?">
            </div>
            <div class="form-group">
                <label>âœ¨ how should this feel?</label>
                <select name="style" id="styleSelect" required>
                    <option value="" disabled selected>pick a feeling...</option>
                    <option value="flirty">ğŸ˜‰ flirty Â· make them blush</option>
                    <option value="romantic">ğŸŒ¹ romantic Â· sweep them off their feet</option>
                    <option value="warm">â˜€ï¸ warm Â· like a cozy hug</option>
                    <option value="apology">ğŸ’™ apology Â· say what you meant to</option>
                    <option value="missing_you">ğŸŒ™ missing you Â· the quiet kind of hurt</option>
                    <option value="grateful">ğŸ™ grateful Â· because they deserve to know</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸ’¬ your message <span class="hint">Â· leave blank we'll write one ğŸŒ™</span></label>
                <textarea name="message" placeholder="write what your heart wants to say..."></textarea>
            </div>

            <div class="section-toggle" onclick="toggleSection('openWhenSection', this)">
                ğŸ’Œ add open when letters <span class="toggle-icon">ï¼‹</span>
            </div>
            <div id="openWhenSection" style="display:none;" class="section-content">
                <p class="optional-note" style="margin-bottom:1rem;">little notes they open for specific moments ğŸŒ¸</p>
                <div id="openWhenList"></div>
                <button type="button" class="btn-add" onclick="addOpenWhen()">ï¼‹ add a letter</button>
            </div>

            <div class="section-toggle" onclick="toggleSection('passwordSection', this)">
                ğŸ”’ add a secret password <span class="toggle-icon">ï¼‹</span>
            </div>
            <div id="passwordSection" style="display:none;" class="section-content">
                <p class="optional-note" style="margin-bottom:0.8rem;">they'll need this to open the jar ğŸŒ™</p>
                <div class="form-group" style="margin-bottom:0;">
                    <input type="text" name="password" placeholder="something only they would know...">
                </div>
            </div>

            <div class="section-toggle" onclick="toggleSection('scheduleSection', this)">
                â° schedule delivery <span class="toggle-icon">ï¼‹</span>
            </div>
            <div id="scheduleSection" style="display:none;" class="section-content">
                <p class="optional-note" style="margin-bottom:0.8rem;">send it at the perfect moment ğŸ’•</p>
                <div class="form-group" style="margin-bottom:0;">
                    <input type="datetime-local" name="scheduled_for">
                </div>
            </div>

            <div style="margin-top:1.5rem;">
                <button type="submit" class="btn" id="submitBtn">seal the jar âœ¨</button>
            </div>
        </form>
        <div class="card-deco bottom">ğŸ’• Â· Â· Â· ğŸ’•</div>
    </div>

    <div class="footer">
        <p>made with ğŸ’— and too much coffee</p>
        <p><a href="/secret">Â· Â· Â·</a></p>
    </div>
</div>

<style>
body.pink-world { background: linear-gradient(160deg, #ffe0ec 0%, #ffc2d4 30%, #ffb3c6 60%, #ff8fab 100%); min-height: 100vh; color: #6b1a30; font-family: 'DM Sans', sans-serif; }
.blob { position: fixed; border-radius: 50%; filter: blur(80px); pointer-events: none; z-index: 0; opacity: 0.5; }
.blob1 { width: 400px; height: 400px; background: #ff8fab; top: -100px; left: -100px; animation: blobMove 8s ease-in-out infinite; }
.blob2 { width: 350px; height: 350px; background: #ffccd5; bottom: -80px; right: -80px; animation: blobMove 10s ease-in-out infinite reverse; }
.blob3 { width: 250px; height: 250px; background: #ff4d6d; top: 50%; left: 50%; transform: translate(-50%,-50%); animation: blobMove 12s ease-in-out infinite 2s; }
@keyframes blobMove { 0%,100%{transform:scale(1) translate(0,0);}33%{transform:scale(1.1) translate(20px,-20px);}66%{transform:scale(0.95) translate(-15px,15px);} }
.music-btn { position: fixed; top: 16px; right: 16px; z-index: 100; background: rgba(255,255,255,0.7); border: 2px solid #ff8fab; border-radius: 22px; width: 44px; height: 44px; font-size: 1.2rem; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s; box-shadow: 0 4px 15px rgba(255,105,180,0.3); white-space: nowrap; overflow: hidden; }
.music-btn.playing { animation: musicPulse 1s ease-in-out infinite; }
@keyframes musicPulse { 0%,100%{box-shadow:0 4px 15px rgba(255,105,180,0.3);}50%{box-shadow:0 4px 25px rgba(255,105,180,0.7);} }
.rain-hearts { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
.rain-heart { position: absolute; top: -60px; font-size: var(--size); animation: rainDown var(--dur) linear infinite; animation-delay: var(--delay); opacity: 0.7; }
@keyframes rainDown { 0%{transform:translateY(0) rotate(0deg);opacity:0;}10%{opacity:0.7;}90%{opacity:0.5;}100%{transform:translateY(110vh) rotate(20deg);opacity:0;} }
.container { position: relative; z-index: 1; max-width: 560px; margin: 0 auto; padding: 2rem 1.5rem 4rem; text-align: center; }
.hero { margin-bottom: 2rem; }
.jar-bounce { font-size: 5rem; display: block; margin-bottom: 0.5rem; animation: jarFloat 2.5s ease-in-out infinite; filter: drop-shadow(0 8px 20px rgba(255,77,109,0.4)); }
@keyframes jarFloat { 0%,100%{transform:translateY(0) rotate(-4deg);}50%{transform:translateY(-15px) rotate(4deg);} }
h1 { font-family: 'Playfair Display', serif !important; font-size: 3.8rem !important; font-weight: 600 !important; color: #c9184a !important; -webkit-text-fill-color: #c9184a !important; background: none !important; text-shadow: 2px 2px 0px rgba(255,255,255,0.5) !important; margin-bottom: 0.8rem !important; }
.subtitle { color: #6b1a30 !important; font-size: 1.05rem !important; line-height: 1.6 !important; margin-bottom: 1rem !important; }
.hearts-row { font-size: 1.3rem; letter-spacing: 0.3rem; margin: 1rem 0 1.5rem; animation: heartsWave 2s ease-in-out infinite; }
@keyframes heartsWave { 0%,100%{transform:scale(1);}50%{transform:scale(1.05);} }
.form-card { background: rgba(255,255,255,0.55) !important; backdrop-filter: blur(20px) !important; border: 2px solid rgba(255,143,171,0.4) !important; border-radius: 24px !important; padding: 2rem !important; box-shadow: 0 20px 60px rgba(201,24,74,0.15), inset 0 1px 0 rgba(255,255,255,0.8) !important; position: relative; }
.card-deco { color: #ff8fab; font-size: 0.9rem; letter-spacing: 0.5rem; }
.card-deco.top { margin-bottom: 1.5rem; }
.card-deco.bottom { margin-top: 1.5rem; }
.form-group { margin-bottom: 1.2rem; text-align: left; }
label { color: #c9184a !important; font-weight: 600 !important; font-size: 0.92rem !important; display: block; margin-bottom: 0.4rem; }
label .hint { font-weight: 300; color: #a44a65; font-style: italic; }
input[type="text"], input[type="datetime-local"], textarea, select { width: 100%; padding: 0.85rem 1rem; border-radius: 12px; border: 2px solid rgba(255,143,171,0.4); background: rgba(255,255,255,0.7); color: #6b1a30; font-size: 0.97rem; font-family: 'DM Sans', sans-serif; transition: all 0.3s; box-sizing: border-box; }
input:focus, textarea:focus, select:focus { outline: none; border-color: #ff4d6d; background: rgba(255,255,255,0.9); box-shadow: 0 0 0 4px rgba(255,77,109,0.12); }
input::placeholder, textarea::placeholder { color: #c4849a; font-style: italic; }
select option { background: #fff0f3; color: #6b1a30; }
textarea { min-height: 100px; resize: vertical; }
.optional-note { font-size: 0.82rem; color: #a44a65; font-style: italic; }
.btn { display: block; width: 100%; background: linear-gradient(135deg, #ff4d6d 0%, #c9184a 100%); color: white; border: none; border-radius: 50px; padding: 1.1rem 2rem; font-size: 1.1rem; font-family: 'DM Sans', sans-serif; font-weight: 500; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 25px rgba(201,24,74,0.4); }
.btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(201,24,74,0.5); }
.section-toggle { background: rgba(255,255,255,0.5); border: 1.5px solid rgba(255,143,171,0.4); border-radius: 12px; padding: 0.8rem 1rem; margin: 0.8rem 0 0; cursor: pointer; color: #c9184a; font-weight: 600; font-size: 0.9rem; text-align: left; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; }
.section-toggle:hover { background: rgba(255,255,255,0.7); }
.section-toggle.open { border-radius: 12px 12px 0 0; border-bottom: none; }
.toggle-icon { font-size: 1.2rem; transition: transform 0.3s; }
.section-toggle.open .toggle-icon { transform: rotate(45deg); }
.section-content { background: rgba(255,255,255,0.4); border: 1.5px solid rgba(255,143,171,0.4); border-top: none; border-radius: 0 0 12px 12px; padding: 1rem; margin-bottom: 0.5rem; text-align: left; }
.ow-row { display: flex; gap: 0.5rem; margin-bottom: 0.6rem; align-items: flex-start; }
.ow-remove { background: rgba(201,24,74,0.1); border: 1px solid rgba(201,24,74,0.2); color: #c9184a; border-radius: 8px; padding: 0.6rem 0.8rem; cursor: pointer; font-size: 0.9rem; flex-shrink: 0; font-family: 'DM Sans', sans-serif; }
.btn-add { background: rgba(255,77,109,0.1); border: 1.5px dashed rgba(255,77,109,0.4); color: #c9184a; border-radius: 10px; padding: 0.6rem 1.2rem; font-size: 0.88rem; cursor: pointer; font-family: 'DM Sans', sans-serif; margin-top: 0.4rem; transition: all 0.2s; }
.btn-add:hover { background: rgba(255,77,109,0.2); }
.footer { margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,143,171,0.3); color: #a44a65; font-size: 0.85rem; line-height: 1.6; }
.footer a { color: #c9184a; text-decoration: none; }
@keyframes promptBounce { 0%,100%{transform:translateX(-50%) translateY(0);}50%{transform:translateX(-50%) translateY(-6px);} }
</style>

<script src="{{ url_for('static', filename='script.js') }}"></script>
<script>
const allHearts = ['â¤ï¸','ğŸ©·','ğŸ’•','ğŸ’—','ğŸ’“','ğŸŒ¸','âœ¨','ğŸ’','ğŸŒ¹','ğŸ’','ğŸ’˜'];
const rainEl = document.getElementById('rainHearts');
for (let i = 0; i < 30; i++) {
    const h = document.createElement('div');
    h.className = 'rain-heart';
    h.innerHTML = allHearts[Math.floor(Math.random() * allHearts.length)];
    h.style.setProperty('--size', (Math.random() * 22 + 10) + 'px');
    h.style.setProperty('--dur', (Math.random() * 6 + 5) + 's');
    h.style.setProperty('--delay', -(Math.random() * 10) + 's');
    h.style.left = (Math.random() * 100) + '%';
    rainEl.appendChild(h);
}

const songs = [document.getElementById('bgMusic1'), document.getElementById('bgMusic2')];
const musicBtn = document.getElementById('musicBtn');
let playing = false, currentSong = 0;
const songNames = ['ğŸµ nothing holding me back', 'ğŸµ you and me'];

function toggleMusic() {
    if (!playing) {
        songs[currentSong].src = songs[currentSong].src.replace('autoplay=0','autoplay=1');
        playing = true;
        musicBtn.textContent = songNames[currentSong];
        musicBtn.style.width = 'auto'; musicBtn.style.padding = '0 14px'; musicBtn.style.fontSize = '0.72rem';
        musicBtn.classList.add('playing');
    } else {
        songs[currentSong].src = songs[currentSong].src.replace('autoplay=1','autoplay=0');
        currentSong = (currentSong + 1) % 2;
        playing = false;
        musicBtn.textContent = 'ğŸµ';
        musicBtn.style.width = '44px'; musicBtn.style.padding = '0'; musicBtn.style.fontSize = '1.2rem';
        musicBtn.classList.remove('playing');
    }
}

// music prompt
setTimeout(() => {
    const prompt = document.createElement('div');
    prompt.id = 'musicPrompt';
    prompt.style.cssText = `position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);border:2px solid rgba(255,143,171,0.5);border-radius:50px;padding:0.7rem 1.4rem;font-family:'DM Sans',sans-serif;font-size:0.88rem;color:#c9184a;font-weight:600;cursor:pointer;z-index:200;box-shadow:0 8px 25px rgba(255,77,109,0.2);animation:promptBounce 1s ease-in-out infinite;white-space:nowrap;`;
    prompt.textContent = 'ğŸµ tap for music ğŸ’—';
    prompt.onclick = () => { toggleMusic(); prompt.remove(); };
    document.body.appendChild(prompt);
}, 1000);

function toggleSection(id, btn) {
    const sec = document.getElementById(id);
    const isOpen = sec.style.display !== 'none';
    sec.style.display = isOpen ? 'none' : 'block';
    btn.classList.toggle('open', !isOpen);
}

const PROMPTS = ["open when you miss me","open when you're sad","open when you need a smile","open when you can't sleep","open when you feel lost","open when you need a hug","open when you doubt yourself","open when you need to laugh"];
let owCount = 0;
function addOpenWhen() {
    const list = document.getElementById('openWhenList');
    const row = document.createElement('div');
    row.className = 'ow-row';
    row.id = 'owrow_' + owCount;
    const prompt = PROMPTS[owCount % PROMPTS.length];
    row.innerHTML = `
        <div style="flex:1;display:flex;flex-direction:column;gap:0.4rem;">
            <input type="text" name="ow_prompt" placeholder="${prompt}" value="${prompt}">
            <textarea name="ow_note" placeholder="write what they should read in this moment..." style="min-height:70px;resize:vertical;width:100%;padding:0.6rem 0.8rem;border-radius:10px;border:2px solid rgba(255,143,171,0.4);background:rgba(255,255,255,0.7);color:#6b1a30;font-size:0.88rem;font-family:'DM Sans',sans-serif;box-sizing:border-box;"></textarea>
        </div>
        <button type="button" class="ow-remove" onclick="document.getElementById('owrow_${owCount}').remove()">âœ•</button>`;
    list.appendChild(row);
    owCount++;
}

document.getElementById('mainForm').addEventListener('submit', function() {
    try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        [523,659,784,1047].forEach((freq,i) => {
            const o = ctx.createOscillator(), g = ctx.createGain();
            o.connect(g); g.connect(ctx.destination);
            o.frequency.value = freq; o.type = 'sine';
            g.gain.setValueAtTime(0.2, ctx.currentTime + i*0.15);
            g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i*0.15 + 0.4);
            o.start(ctx.currentTime + i*0.15); o.stop(ctx.currentTime + i*0.15 + 0.5);
        });
    } catch(e) {}
    const btn = document.getElementById('submitBtn');
    btn.textContent = 'ğŸ«™ sealing with love...';
    btn.disabled = true;
});
</script>
</body>
</html>